{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "git-platform-sync",
  "type": "registry:block",
  "title": "Git Platform Sync",
  "description": "A component that implements repo syncing between code.storage and git platforms like GitHub.",
  "dependencies": [
    "@pierre/sync-ui-core",
    "@pierre/sync-ui-hooks"
  ],
  "registryDependencies": [
    "button",
    "command",
    "field",
    "input",
    "popover",
    "select",
    "tooltip"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/git-platform-sync/git-platform-sync.tsx",
      "content": "'use client';\n\nimport { Button } from '@/components/ui/button';\nimport { Field, FieldLabel } from '@/components/ui/field';\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\nimport { cn } from '@/lib/utils';\nimport * as PopoverPrimitive from '@radix-ui/react-popover';\nimport { BookOpen, ChevronDown } from 'lucide-react';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { ComboBox } from './combobox';\n\n// TODO: determine if this is the canonical way to import other components inside of a block\n\ntype Step = 'welcome' | 'sync';\n\ntype RepositoryData = {\n  /**\n   * @description The owner of the repository, also referred to as the 'scope' - usually\n   * the username of the user or an organization they belong to.\n   */\n  owner?: string;\n  /**\n   * @description The name of the repository, this is a 'slug' style name.\n   */\n  name?: string;\n  /**\n   * @description The branch of the repository, this is the branch that will be used to sync\n   */\n  branch?: string;\n};\n\nconst GitHubIcon = ({ className, ...props }: React.SVGProps<SVGSVGElement>) => (\n  <svg\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    className={cn('h-full w-auto', className)}\n    {...props}\n  >\n    <path\n      d=\"M8 0C12.42 0 16 3.58 16 8C15.9996 9.6762 15.4735 11.3101 14.4958 12.6716C13.5182 14.0332 12.1381 15.0539 10.55 15.59C10.15 15.67 10 15.42 10 15.21C10 14.94 10.01 14.08 10.01 13.01C10.01 12.26 9.76 11.78 9.47 11.53C11.25 11.33 13.12 10.65 13.12 7.58C13.12 6.7 12.81 5.99 12.3 5.43C12.38 5.23 12.66 4.41 12.22 3.31C12.22 3.31 11.55 3.09 10.02 4.13C9.38 3.95 8.7 3.86 8.02 3.86C7.34 3.86 6.66 3.95 6.02 4.13C4.49 3.1 3.82 3.31 3.82 3.31C3.38 4.41 3.66 5.23 3.74 5.43C3.23 5.99 2.92 6.71 2.92 7.58C2.92 10.64 4.78 11.33 6.56 11.53C6.33 11.73 6.12 12.08 6.05 12.6C5.59 12.81 4.44 13.15 3.72 11.94C3.57 11.7 3.12 11.11 2.49 11.12C1.82 11.13 2.22 11.5 2.5 11.65C2.84 11.84 3.23 12.55 3.32 12.78C3.48 13.23 4 14.09 6.01 13.72C6.01 14.39 6.02 15.02 6.02 15.21C6.02 15.42 5.87 15.66 5.47 15.59C3.87664 15.0596 2.49073 14.041 1.50889 12.6786C0.527047 11.3163 -0.000880479 9.67931 1.10231e-06 8C1.10231e-06 3.58 3.58 0 8 0Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport type GitPlatformSyncStatus =\n  | 'disconnected'\n  | 'connected'\n  | 'connected-syncing'\n  | 'connected-warning';\n\n/**\n * @description Platforms that code.storage supports\n */\nexport type SupportedGitPlatform = 'github';\nexport type GitPlatformSyncProps = React.ComponentProps<typeof Popover> & {\n  /**\n   * @default ['github']\n   * @description List of supported platforms that you want to offer to the user. We recommend\n   * not setting this until we support more platforms.\n   */\n  platforms?: SupportedGitPlatform[];\n\n  /**\n   * @default 'icon-only'\n   * @description Variant display of the button that opens the sync popover. The\n   * `icon-grow` variant will appear as the `icon` variant until hovered or focused,\n   * and then grow to appear as the `full` variant.\n   */\n  variant?: 'icon-only' | 'icon-grow' | 'full';\n\n  /**\n   * @default true\n   * @description Whether to show the sync indicator in the button, e.g. the little colored dot\n   */\n  showSyncIndicator?: boolean;\n\n  /**\n   * @default 'end'\n   * @description The alignment of the popover content\n   */\n  align?: React.ComponentProps<typeof PopoverContent>['align'];\n\n  /**\n   * @default 'auto'\n   * @description This controls the status dot that appears in the button. If `auto` is set, then\n   * the component will determine either `disconnected` or `connected`. However, an implementor may\n   * choose to override this as `connected-syncing` or `connected-warning`. Note that the component\n   * will not verify that the status is valid, it will faithfully render the status you provide.\n   */\n  status?: 'auto' | GitPlatformSyncStatus;\n\n  /**\n   * @description Options for what features to offer the user in the resository selection\n   */\n  repositoryOptions?: {\n    /**\n     * @default undefined\n     * @description This directly sets the name of the repository that will be created. Setting this\n     * will take precedence over the `initialName` option. Users will not be able to change from this\n     * name.\n     */\n    name?: string;\n    /**\n     * @default undefined\n     * @description If you'd like to suggest a name for the repository, but allow the user to customize it,\n     * this is the initial value of the repository name field. This will be ignored if the `name` option is\n     * set.\n     */\n    initialName?: string;\n    /**\n     * @default 'main'\n     * @description The branch that will be used to sync within the repository. `main` is used if this is not\n     * provided.\n     */\n    defaultBranch?: string;\n  };\n\n  /**\n   * @description Callback when a user successfully creates a sync repository.\n   */\n  onRepoCreated?: (repoData: RepositoryData) => void;\n\n  /**\n   *\n   * @description Callback when the user clicks the 'Help me get started' button. If this callback is\n   * not provided, the 'Help me get started' button will not be shown.\n   */\n  onHelpAction?: () => void;\n\n  /**\n   * @description Callback when the popover is opened.\n   */\n  onOpen?: () => void;\n  /**\n   * @description Callback when the popover is closed.\n   */\n  onClose?: () => void;\n\n  /**\n   * @deprecated Internal use only, not guaranteed to be supported in the future\n   * @description The container to render the popover portal in, only used for docs. This requires\n   * modifying the shadcn Popover component to accept a container prop for the portal\n   */\n  __container?: React.ComponentProps<\n    typeof PopoverPrimitive.Portal\n  >['container'];\n};\n\nexport function GitPlatformSync({\n  // currently this is unused since we only support GitHub, but we'll keep it for future use\n  platforms = ['github'],\n  variant = 'icon-only',\n  align = 'end',\n  status: statusProp = 'auto',\n  onHelpAction,\n  onOpen,\n  onClose,\n  __container,\n  ...props\n}: GitPlatformSyncProps) {\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n  const [isTooltipOpen, setIsTooltipOpen] = useState(false);\n\n  const status = useMemo(() => {\n    if (statusProp === 'auto') {\n      // TODO: when we can determine connected vs disconnected, we should update it here\n      return 'disconnected';\n    }\n    return statusProp;\n  }, [statusProp]);\n\n  // We want to make sure the container internal stuff doesn't blow up anyone's types\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const containerProp: any = __container ? { container: __container } : {};\n\n  let platformName: string | undefined;\n\n  const handleOpenChange = useCallback(\n    (open: boolean) => {\n      setIsPopoverOpen(open);\n      if (open) {\n        onOpen?.();\n      } else {\n        onClose?.();\n      }\n    },\n    [onOpen, onClose]\n  );\n\n  if (platforms.length === 0) {\n    console.error('No platforms provided to GitPlatformSync');\n    return null;\n  }\n\n  if (platforms.length === 1 && platforms[0] === 'github') {\n    platformName = 'GitHub';\n  } else {\n    console.error('Currently GitPlatformSync only supports GitHub');\n    return null;\n  }\n\n  const labelText = `Sync to ${platformName}`;\n\n  // If we don't have any label inside the button we should set an aria-label\n  // that describes what that button does.\n  const buttonAriaLabelProp =\n    variant === 'icon-only'\n      ? {\n          'aria-label': labelText,\n        }\n      : {};\n\n  // TODO: fix full button, and disable tooltip on open popover\n  return (\n    <Popover open={isPopoverOpen} onOpenChange={handleOpenChange} {...props}>\n      {variant === 'icon-only' ? (\n        <>\n          <Tooltip\n            open={isPopoverOpen ? false : isTooltipOpen}\n            onOpenChange={setIsTooltipOpen}\n            delayDuration={800}\n          >\n            <TooltipTrigger asChild>\n              <PopoverTrigger asChild>\n                <BaseSyncButton {...buttonAriaLabelProp} status={status} />\n              </PopoverTrigger>\n            </TooltipTrigger>\n            <TooltipContent {...containerProp}>{labelText}</TooltipContent>\n          </Tooltip>\n          <PopoverConductor\n            align={align}\n            __container={__container}\n            onHelpAction={onHelpAction}\n          />\n        </>\n      ) : (\n        <>\n          <PopoverTrigger asChild>\n            <BaseSyncButton\n              {...buttonAriaLabelProp}\n              className=\"gap-0\"\n              status={status}\n            >\n              <span\n                className={cn(\n                  'justify-between items-center gap-2 text-foreground transition-width delay-200 group-focus:delay-0 duration-150 ease-in-out overflow-hidden inline-flex select-none',\n                  variant === 'icon-grow' && !isPopoverOpen\n                    ? 'max-w-0 opacity-0 group-hover:opacity-100 group-hover:max-w-48 group-focus:opacity-100 group-focus:max-w-48 group-focus:pl-2 group-focus:-mr-1 group-hover:pl-2 group-hover:-mr-1'\n                    : 'max-w-48 pl-2 -mr-1 opacity-100'\n                )}\n              >\n                {labelText}\n                <ChevronDown className=\"h-4 w-4 text-muted-foreground transition-colors group-hover:text-foreground\" />\n              </span>\n            </BaseSyncButton>\n          </PopoverTrigger>\n          <PopoverConductor\n            align={align}\n            __container={__container}\n            onHelpAction={onHelpAction}\n          />\n        </>\n      )}\n    </Popover>\n  );\n}\n\nfunction LilDotGuy({ status }: { status?: GitPlatformSyncStatus }) {\n  if (!status || status === 'disconnected') {\n    return null;\n  }\n  return (\n    <div\n      className={cn(\n        'absolute -bottom-0.5 -right-0.5 h-2 w-2 rounded-full border border-background',\n        status === 'connected' && 'bg-green-500',\n        status === 'connected-syncing' && 'bg-yellow-500',\n        status === 'connected-warning' && 'bg-red-500'\n      )}\n    />\n  );\n}\n\nfunction BaseSyncButton({\n  children,\n  className,\n  status,\n  ...props\n}: React.ComponentProps<typeof Button> & {\n  status?: GitPlatformSyncStatus;\n}) {\n  return (\n    <Button\n      variant=\"outline\"\n      className={cn(\n        'group flex justify-between items-center gap-2 text-foreground px-3',\n        className\n      )}\n      {...props}\n    >\n      <div\n        className=\"relative flex justify-center items-center h-lh\"\n        aria-hidden\n      >\n        <GitHubIcon />\n        <LilDotGuy status={status} />\n      </div>\n      {children}\n    </Button>\n  );\n}\n\nfunction PopoverConductor({\n  align,\n  __container,\n  onHelpAction,\n}: Pick<GitPlatformSyncProps, 'align' | '__container' | 'onHelpAction'>) {\n  const [step, setStep] = useState<Step>('welcome');\n\n  // We want to make sure the container internal stuff doesn't blow up anyone's types\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const containerProp: any = __container ? { container: __container } : {};\n\n  return (\n    <PopoverContent className=\"w-96\" align={align} {...containerProp}>\n      {step === 'welcome' ? (\n        <StepWelcome\n          onInstallApp={() => setStep('sync')}\n          onHelpAction={onHelpAction}\n        />\n      ) : null}\n      {step === 'sync' ? <StepSync __container={__container} /> : null}\n    </PopoverContent>\n  );\n}\n\ntype StepWelcomeProps = {\n  onInstallApp?: () => void;\n  onHelpAction?: () => void;\n};\n\nfunction StepWelcome({ onInstallApp, onHelpAction }: StepWelcomeProps) {\n  return (\n    <>\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <h4 className=\"font-normal leading-none\">Connect to GitHub</h4>\n          <p className=\"text-sm text-muted-foreground\">\n            Sync your changes to GitHub to backup your code at every snapshot by\n            installing our app on your personal account or organization.\n          </p>\n        </div>\n        <div className=\"flex flex-col gap-3\">\n          <Button onClick={onInstallApp} size=\"lg\" className=\"w-full\">\n            <GitHubIcon /> Install GitHub App\n          </Button>\n          {onHelpAction ? (\n            <Button\n              onClick={onHelpAction}\n              size=\"lg\"\n              variant=\"secondary\"\n              className=\"w-full\"\n            >\n              <BookOpen /> Help me get started\n            </Button>\n          ) : null}\n        </div>\n      </div>\n    </>\n  );\n}\n\ntype StepSyncProps = {\n  onOwnerChange?: (owner: string) => void;\n  onRepoChange?: (repo: string) => void;\n  onBranchChange?: (branch: string) => void;\n  /**\n   * @deprecated Internal use only, not guaranteed to be supported in the future\n   * @description The container to render the popover portal in, only used for docs. This requires\n   * modifying the shadcn Popover component to accept a container prop for the portal\n   */\n  __container?: React.ComponentProps<\n    typeof PopoverPrimitive.Portal\n  >['container'];\n};\n\nfunction StepSync({\n  // onOwnerChange,\n  // onRepoChange,\n  // onBranchChange,\n  __container,\n}: StepSyncProps) {\n  // We want to make sure the container internal stuff doesn't blow up anyone's types\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const containerProp: any = __container ? { __container: __container } : {};\n\n  return (\n    <>\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <h4 className=\"font-normal leading-none\">Sync to GitHub</h4>\n          <p className=\"text-sm text-muted-foreground\">\n            Create a new repository or choose an existing one to sync your\n            changes. We&apos;ll push changes with each new prompt you send.\n          </p>\n        </div>\n        <div className=\"flex flex-col gap-3\">\n          <div className=\"flex flex-row gap-1\">\n            <Field className=\"w-fit flex-shrink-0\">\n              <FieldLabel htmlFor=\"github-owner\">Owner</FieldLabel>\n              <ComboBox\n                id=\"github-owner\"\n                {...containerProp}\n                initialValue={'pierredotco'}\n                options={[\n                  { value: 'slexaxton', label: 'SlexAxton' },\n                  { value: 'pierredotco', label: 'pierredotco' },\n                  { value: 'jquery', label: 'jQuery' },\n                ]}\n              />\n            </Field>\n            <Field className=\"flex-1\">\n              <FieldLabel htmlFor=\"github-repo\">Repository</FieldLabel>\n              <ComboBox\n                id=\"github-repo\"\n                width=\"full\"\n                {...containerProp}\n                initialValue={'gh-monorepo'}\n                options={[\n                  { value: 'yepnope', label: 'SlexAxton' },\n                  { value: 'jquery', label: 'jQuery' },\n                  { value: 'modernizr', label: 'modernizr' },\n                  { value: 'gh-monorepo', label: 'monorepo' },\n                ]}\n              />\n            </Field>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n",
      "type": "registry:component"
    }
  ]
}