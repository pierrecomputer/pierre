import { types as babelTypes } from '@babel/core';

export default function template(variables, { tpl }) {
  const { componentName, jsx } = variables;

  // Extract viewBox from JSX to calculate aspect ratio
  const viewBoxMatch = jsx.openingElement.attributes.find(
    (attr) => attr.name && attr.name.name === 'viewBox'
  );

  let aspectRatio = 1;
  if (viewBoxMatch && viewBoxMatch.value && viewBoxMatch.value.value) {
    const viewBoxValues = viewBoxMatch.value.value.split(' ').map(Number);
    if (viewBoxValues.length >= 4) {
      const [, , viewBoxWidth, viewBoxHeight] = viewBoxValues;
      aspectRatio = viewBoxWidth / viewBoxHeight;
    }
  }

  const aspectRatioNode = babelTypes.numericLiteral(aspectRatio);

  return tpl`
// Generated by \`bun run icons:build\`, see README for details
import { Colors, type IconProps } from '../Color';

export function ${componentName}({
  size = 16,
  color = "currentcolor",
  style,
  className,
  ...props
}: IconProps) {
  const height = size;
  const width = size === "1em" ? "1em" : Math.round(Number(size) * ${aspectRatioNode});

  return (
    ${jsx}
  );
}
`;
}
